<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>网站后台管理模版</title>
		<link rel="stylesheet" type="text/css" href="/admin/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="/admin/css/admin.css"/>
	</head>
	<body>
		<div class="layui-tab page-content-wrap">
		  <ul class="layui-tab-title">
		    <li class="layui-this">修改资料</li>
		    <li>修改密码</li>
		  </ul>
		  <div class="layui-tab-content">
		    <div class="layui-tab-item layui-show">
		    	<form class="layui-form"  style="width: 90%;padding-top: 20px;">
				  <div class="layui-form-item">
				    <label class="layui-form-label">人员编号：</label>
				    <div class="layui-input-block">
						<input type="hidden" name="staffId" id="hiddenStaffId" th:value="${staffId}">
				      <input type="text" name="staffId"  disabled autocomplete="off" class="layui-input layui-disabled" value="1">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">用户名：</label>
				    <div class="layui-input-block">
				      <input type="text" name="theUserName"  disabled autocomplete="off" class="layui-input layui-disabled" value="admin">
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">姓名：</label>
				    <div class="layui-input-block">
				      <input type="text" name="staffname" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" value="未知">
				    </div>
				  </div>
				     <div class="layui-form-item">
				    <label class="layui-form-label">性别：</label>
				    <div class="layui-input-block">
				      <input type="text" name="sex" disabled autocomplete="off" class="layui-input layui-disabled" value="admin">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">身份证号：</label>
				    <div class="layui-input-block">
				      <input type="text" name="cardId" disabled autocomplete="off" class="layui-input layui-disabled" value="admin">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">QQ号码：</label>
				    <div class="layui-input-block">
				      <input type="text" name="qqnumber" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" value="未知">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">头像地址：</label>
				    <div class="layui-input-block">
						<input type="file" id="imageFile" name="multipartFile" onchange="showimg()"/><img src="" style="width: 60px;height: 60px" id="imgs">
				    </div>
				  </div>
					<div class="layui-form-item">
						<label class="layui-form-label">职务：</label>
						<div class="layui-input-block" id="Job-list">
							<select id="roleId" name="roleId" lay-filter="status">
								<option value="0">请选择职务</option>
								<option value="1">经理</option>
								<option value="2">总控</option>
								<option value="3">计调</option>
							</select>
						</div>
					</div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">现住址：</label>
				    <div class="layui-input-block">
				      <input type="text" name="currentAddress" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" value="未知">
				    </div>
				  </div>

				  <div class="layui-form-item">
				    <label class="layui-form-label">联系电话：</label>
				    <div class="layui-input-block">
				      <input type="text" name="phone" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" value="未知">
				    </div>
				  </div>

					<div class="layui-form-item" id="mm">
						<label class="layui-form-label">密码：</label>
						<div class="layui-input-block">
							<input type="text" name="password" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" value="未知">
						</div>
					</div>

				  <div class="layui-form-item">
				    <div class="layui-input-block">
				      <input type="button" class="layui-btn layui-btn-normal" lay-submit lay-filter="adminInfo" onclick="updateStaffInfo()" value="立即提交"></input>
				    </div>
				  </div>
				</form>
		    </div>
		    <div class="layui-tab-item">
		    	<form class="layui-form" v style="width: 90%;padding-top: 20px;">
				  <div class="layui-form-item">
				    <label class="layui-form-label">用户名：</label>
				    <div class="layui-input-block">
						<input type="hidden" name="staffId" id="hiddenStaffIds" th:value="${staffId}">
				      <input type="text" name="username" disabled autocomplete="off" class="layui-input layui-disabled" value="admin">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">旧密码：</label>
				    <div class="layui-input-block">
				      <input type="password" name="password1" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">新密码：</label>
				    <div class="layui-input-block">
				      <input type="password" name="password2" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">重复密码：</label>
				    <div class="layui-input-block">
				      <input type="password" name="password3" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <div class="layui-input-block">
						<input type="button" class="layui-btn layui-btn-normal" lay-submit lay-filter="adminInfo" onclick="updateStaff1()" value="立即提交"></input>
				    </div>
				  </div>
				</form>
		    </div>
		  </div>
		</div>
		<script src="/admin/layui/layui.js" type="text/javascript" charset="utf-8"></script>
		<script src="/admin/js/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript"  src="/js/getUrlParam.js"></script>
		<script src="/js/jquery-1.8.3.min.js"></script>
	<script>
		//Demo
		layui.use(['form','element'], function(){
		  var form = layui.form();
		  var element = layui.element();
		  form.render();
		  //监听信息提交
		  form.on('submit(adminInfo)', function(data){
		    return false;
		  });
		  //监听密码提交
		   form.on('submit(adminPassword)', function(data){
		    return false;
		  });
		});



        $(function() {
            $("#mm").hide();
            getStaffInfoByStaffId();
            getStaffInfoByStaffId1();
        });



        function showimg() {
            var file = document.getElementById("imageFile").files[0];
            //创建读取文件的对象
            var reader = new FileReader();
            //创建文件读取相关的变量
            var imgFile;
            reader.onload=function(e) {
                imgFile = e.target.result;
                $("#imgs").attr('src', imgFile);
                $("#imgs").show();
            };
            //正式读取文件
            reader.readAsDataURL(file);
        }
        //id查询信息
        function getStaffInfoByStaffId() {
            $.ajax({
                url: "/staff/getStaffInfoByStaffId",
                data: {"staffId":2},
                dataType: "json",
                type: "post",
                success: function (ReponseResult) {
                    $("input[name='password']").val(ReponseResult.data.password);
                    $("#roleId").val(ReponseResult.data.roleId);
                    $("input[name='staffname']").val(ReponseResult.data.staffname);
                    if(ReponseResult.data.sex==1){
                        $("input[name='sex']").val("男")
                    }else{
                        $("input[name='sex']").val("女")
                    }
                    $("input[name='staffId']").val(ReponseResult.data.staffId);
                    $("input[name='theUserName']").val(ReponseResult.data.theUserName);
                    /*$("input[name='multipartFile']").val(ReponseResult.data.headPortraitPath);*/
                    $("input[name='cardId']").val(ReponseResult.data.cardId);
                    $("input[name='qqnumber']").val(ReponseResult.data.qqnumber);
                    $("input[name='currentAddress']").val(ReponseResult.data.currentAddress);
                    $("input[name='phone']").val(ReponseResult.data.phone);
                    var savePath = "/images/Scenicspot/";
                    var path=savePath+ReponseResult.data.headPortraitPath;
                    $("#imgs").attr('src', path);
                },
                error: function (res) {
                    /*  alert(res);*/
                }
            })
        }



        //id查询信息
        function getStaffInfoByStaffId1() {
            $.ajax({
                url: "/staff/getStaffInfoByStaffId",
                data: {"staffId":2},
                dataType: "json",
                type: "post",
                success: function (ReponseResult) {
                    $("input[name='username']").val(ReponseResult.data.theUserName);
                },
                error: function (res) {
                    /*  alert(res);*/
                }
            })
        }
        //修改密码方法
        function updateStaff1() {
            var password1=$("input[name=password1]").val();
            var password2=$("input[name=password2]").val();
            var password3=$("input[name=password3]").val();
            if (password1==""||password1==null){
                alert("请输入旧密码！");
                return
			}
            if (password2==""||password2==null){
                alert("请输入新密码！");
                return
            }
            if (password3==""||password3==null){
                alert("请输入重复密码！");
                return
            }
            if (password2!=password3){
                alert("新密码或重复密码不一致请重新输入！");
                return
            }
            $.ajax({
                url:"/staff/updateStaff1",
                data:{password:password3,staffId:2},
                dataType: "json",
                type: "get",
                success:function (data) {
                    if (data.data==1 || data.data=="1"){
                        alert("修改成功");
                    } else{
                        alert("修改失败");
                    }
                    parent.location.reload();
                }
            })
        }


        /*修改用户信息*/
        function updateStaffInfo() {
            var formData = new FormData();
            var savePath = "D://sdglGroundConnection/src/main/resources/static/images/Scenicspot"; // 图片保存路径
            var fileObj = document.getElementById("imageFile").files[0]; // 获取文件对象
            if(fileObj==undefined){
                alert("请选择图片");
                return
            }
            if(fileObj==undefined){
                var file=new File(["first Line Text","Second Line Text"],"a.txt");
                fileObj=file;
            }
            var theUserName= $("input[name='theUserName']").val();
            var sexs="";
            var roleIds="";
            var  roleId= $("#roleId").val();
            var sex= $("input[name='sex']").val()
			if (sex=="男"){
				sexs=1;
			}
            if (sex=="女"){
                sexs=0;
            }
            if(roleId=="经理"){
                roleIds=1;
            }
            if(roleId=="总控"){
                roleIds=2;
            }
            if(roleId=="计调"){
                roleIds=3;
            }
            var password= $("input[name='password']").val();
            var staffname= $("input[name='staffname']").val();
            var headPortraitPath=$("input[name='multipartFile']").val();
            var qqnumber= $("input[name='qqnumber']").val();
            var currentAddress= $("input[name='currentAddress']").val();
            var phone= $("input[name='phone']").val();
            var cardId= $("input[name='cardId']").val();
            var staffId=2;
            // formData对象，用来序列化二进制数据

            formData.append("multipartFile", fileObj);
            formData.append("savePath", savePath);
            formData.append("staffname",staffname);
            formData.append("theUserName",theUserName);
            formData.append("sex",sexs);
            formData.append("cardId",cardId);
            formData.append("headPortraitPath",headPortraitPath);
            formData.append("qqnumber",qqnumber);
            formData.append("currentAddress",currentAddress);
            formData.append("phone",phone);
            formData.append("staffId",staffId);
            formData.append("password",password);
            formData.append("roleId",roleId);
            $.ajax({
                url: "/staff/updateStaff",
                data: formData,
                dataType: "json",
                type: "post",
                cache: false, // 上传文件不需要缓存
                processData: false, // 对参数进行序列化处理
                contentType: false,
                success: function (result) {
                    if (result.code == 0) {
                        alert(result.msg); // 上传成功
                        parent.location.reload();
                    } else {
                        alert(result.msg); // 上传失败
                    }
                },
                error: function (res) {
                    /*  alert(res);*/
                }
            })
        }

	</script>
	</body>
</html>