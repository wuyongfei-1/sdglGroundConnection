<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>网站后台管理模版</title>
    <link rel="stylesheet" type="text/css" href="/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/css/baojiadan.css"/>
</head>
<body>
<div class="page-content-wrap">
    <div id="divhead">
        <form class="layui-form layui-form-pane" action="" id="offer">
            <table border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td><label class="layui-form-label">组团社名称</label></td>
                    <td>
                        <select id="zutuanshe" lay-ignore lay-verify="required">
                        </select>
                    </td>
                    <td><label class="layui-form-label">人数</label></td>
                    <td><input type="text" name="number" onchange="total()" id="number" class="layui-input"></td>
                </tr>
                <tr>
                    <td><label class="layui-form-label">开始时间</label></td>
                    <td><input type="text" name="travelStartTime" id="beginDate" lay-verify="date" placeholder="yyyy-MM-dd"
                               autocomplete="off" class="layui-input"></td>
                    <td><label class="layui-form-label">结束时间</label></td>
                    <td><input type="text" name="travelEndTime" id="endDate" lay-verify="date" placeholder="yyyy-MM-dd"
                               autocomplete="off" class="layui-input"></td>
                </tr>
            </table>
            <table border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td style="display: none"><label class="layui-form-label">选择线路</label></td>
                    <td style="display: none">
                        <select style="height:36px ; width: 170px" id="zongxianlu" lay-ignore onchange="chengZhong(this)">

                        </select>
                    </td>
                    <td><label class="layui-form-label">客源地</label></td>
                    <td><input type="text" id="tourist" class="layui-input"></td>
                </tr>
            </table>
        </form>
    </div>

    <div id="zong" lay-filter="test1">
        <div style='margin-bottom: 30px;width: 800px'>
            <input type="image" src="/images/up.PNG" style="height: 30px;width: 35px;" id="toggle"
                   onclick='qiehuan(this)'/>
            <input type="image" id="sc" src="/images/del.PNG" onclick='shanchu(this)'
                   style="display:inline-block;float: right;height: 30px;width: 35px;"/>
            <div id="content">
                <form class="layui-form layui-form-pane" action="">
                    <table border="0" cellspacing="0" cellpadding="0">
                        <tr>
                            <td><label class="layui-form-label">线路</label></td>
                            <td>
                                <select style="height:36px ; width: 170px" name="city" lay-ignore lay-search xl="xianlu" onchange="chengZi(this)">

                                </select>
                            </td>
                            <td colspan="2">&nbsp;<button type="button"
                                                          class='layui-btn layui-btn-normal layui-btn-radius'
                                                          style='height: 30px;width: 100px;' onclick="xianlu(this)">自行填写
                            </button>
                            </td>
                        </tr>
                        <tr>
                            <td><label class="layui-form-label">日期</label></td>
                            <td>
                                <input type="text" name="date" id="date2" lay-verify="date" placeholder="yyyy-MM-dd"
                                       autocomplete="off" class="layui-input">
                            </td>
                        </tr>

                        <tr>
                            <td><label class="layui-form-label">酒店</label></td>
                            <td>
                                <select style="height:36px ; width: 170px" name="city" lay-ignore hotel="jiudian" onchange="baojia(this)">

                                </select>
                            </td>
                            <td><label class="layui-form-label">成本价</label></td>
                            <td><input type="text" name='costPrice' class="layui-input"></td>
                            <td><label class="layui-form-label">报价</label></td>
                            <td><input type="text" name='offer' class="layui-input"></td>
                        </tr>
                        <!--点击新增景点-->
                        <tr id="onClickjd">
                            <td colspan="2">
                                <button class="layui-btn" type="button" style="font-size: 12px"
                                        onclick="insertJingdian(this)">添加景点+
                                </button>
                            </td>
                        </tr>
                        <!--点击新增结束-->
                        <tr id="scenic">
                            <td><label class="layui-form-label">景点</label></td>
                            <td>
                                <select style="height:36px ; width: 170px" name="city" weight="1" lay-ignore spot="jingdian" onchange="baojia(this)">

                                </select>
                            </td>
                            <td><label class="layui-form-label">成本价:</label></td>
                            <td><input type="text" name='costPrice' class="layui-input"></td>
                            <td><label class="layui-form-label">报价:</label></td>
                            <td><input type="text" name='offer' class="layui-input"></td>
                        </tr>
                        <tr>
                            <td><label class="layui-form-label">午餐</label></td>
                            <td>
                                <select style="height:36px ; width: 170px" name="city" lay-ignore wc="wucan" onchange="baojia(this)">


                                </select>
                            </td>
                            <td><label class="layui-form-label">成本价</label></td>
                            <td><input type="text" name='costPrice' class="layui-input"></td>
                            <td><label class="layui-form-label">报价</label></td>
                            <td><input type="text" name='offer' class="layui-input"></td>
                        </tr>
                        <tr>
                            <td><label class="layui-form-label">晚餐</label></td>
                            <td>
                                <select style="height:36px ; width: 170px" name="city" lay-ignore wac="wancan" onchange="baojia(this)">

                                </select>
                            </td>
                            <td><label class="layui-form-label">成本价</label></td>
                            <td><input type="text" name='costPrice' class="layui-input"></td>
                            <td><label class="layui-form-label">报价</label></td>
                            <td><input type="text" name='offer' class="layui-input"></td>
                        </tr>
                        <tr>
                            <td><label class="layui-form-label">行程</label></td>
                            <td colspan="5"><textarea placeholder="请输入内容" class="layui-textarea" name="desc"></textarea>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
        <!---中结束-->
    </div>
    <button class='layui-btn layui-btn-normal layui-btn-radius' onclick='addss()' id="add">十</button>
    <div id="divfoot">
        <form class="layui-form layui-form-pane" action="">
            <table border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td><label class="layui-form-label">车队：</label></td>
                    <td>
                        <select name="city" lay-ignore id="yongche">

                        </select>
                    </td>
                    <td><label class="layui-form-label">成本价</label></td>
                    <td><input type="text" onchange="total()" id="carcostPrice"  class="layui-input"></td>
                    <td><label class="layui-form-label">报价</label></td>
                    <td><input type="text" onchange="total()" id="caroffer" class="layui-input"></td>
                </tr>
                <tr>
                    <td><label class="layui-form-label">其他:</label></td>
                    <td colspan="5">
                        <table border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td><label class="layui-form-label">备注</label></td>
                                <td width="300px"><input type="text" id="otherremarks" class="layui-input"></td>
                                <td><label class="layui-form-label">成本价</label></td>
                                <td width="300px"><input type="text" onchange="total()" id="othercostPrice" class="layui-input"></td>
                                <td><label class="layui-form-label">报价</label></td>
                                <td width="300px"><input type="text" onchange="total()" id="otheroffer" class="layui-input">
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td><label class="layui-form-label">总计:</label></td>
                    <td colspan="5">
                        <table border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td><label class="layui-form-label">总成本价</label></td>
                                <td width="300px"><input type="text" id="costPriceTotal" class="layui-input"></td>
                                <td><label class="layui-form-label">总报价</label></td>
                                <td width="300px"><input type="text" id="offerTotal" class="layui-input">
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td><label class="layui-form-label">备注：</label></td>
                    <td colspan="5"><textarea placeholder="请输入内容" class="layui-textarea" name="remarks"></textarea></td>
                </tr>
                <tr>
                    <td><label class="layui-form-label">接待标准：</label></td>
                    <td colspan="5"><textarea placeholder="请输入内容" class="layui-textarea" name="reception"></textarea>
                    </td>
                </tr>
                <tr>
                    <td><label class="layui-form-label">不含：</label></td>
                    <td colspan="5"><textarea placeholder="请输入内容" class="layui-textarea" name="notExclude"></textarea>
                    </td>
                </tr>
                <tr>
                    <td><label class="layui-form-label">购物：</label></td>
                    <td colspan="5"><textarea placeholder="请输入内容" class="layui-textarea" name="shopping"></textarea>
                    </td>
                </tr>
                <tr>
                    <td><label class="layui-form-label">团体监督：</label></td>
                    <td colspan="5"><textarea placeholder="请输入内容" class="layui-textarea" name="supervision"></textarea>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <input class='layui-btn layui-btn-normal layui-btn-radius'
                               style="margin-bottom: 50px;margin-top: 50px;width: 110px" value="预览确认书" id="yulan">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <input class='layui-btn layui-btn-normal layui-btn-radius'
                               style="margin-bottom: 50px;margin-top: 50px;width: 110px" value="预览报价单" id="printBaojia">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td>
                        <input value="保存修改" style="margin-bottom: 50px;margin-top: 50px" type="button" class='layui-btn layui-btn-normal layui-btn-radius'
                               id="baocun">
                    </td>
                </tr>
                <tr>
                    <td><input id="offerId" type="hidden" th:value="${offerId}"></td>
                    <td><input id="redonly" type="hidden" th:value="${redonly}"></td>
                </tr>
            </table>
        </form>
        <!--底部div结束-->
    </div>

</div>
<script type="text/javascript" src="/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="/layui.js"></script>
<script type="text/javascript" src="/js/baojiadan.js"></script>
<script type="text/javascript" src="/js/offer.js"></script>
<script type="text/javascript" src="/lodop/jquery-3.2.1.js"></script>
<script type="text/javascript" src="/lodop/LodopFuncs.js"></script>

<script>
    var selectJson = [];//存放总线路中的酒店id以及景点id等信息
    var selectJson2 = [];//存放线路中的酒店id以及景点id等信息
    var selectJson3 = [];//存放线路中的酒店id以及景点id等信息
    var zongxinalu = "<option value=''>请选择</option>";
    var jingdian = "<option value=''>请选择</option>";
    var jiudian = "<option value=''>请选择</option>";
    var wancan = "<option value=''>请选择</option>";
    var wucan = "<option value=''>请选择</option>";
    var xianluinfo = "<option value=''>请选择</option>";
    var chedui = "<option value=''>请选择</option>";
    var zutuanshe = "<option value=''>请选择</option>";

    showOfferInto();

    //显示当前报价详情
    function showOfferInto() {
        $.ajax({
            url: "/offer/getOfferByOfferId",
            data: {offerId: $("#offerId").val()},
            dataType: "json",
            async: false,
            type: "get",
            success: function (data) {
                selectJson3 = [];
                var context = "";
                var countspot = 0;//景点权重
                var day;//天数
                for (var key in data.data) {
                    var context2 = "";
                    if (key != "-1" && key != "-2" && key != "-3") {
                        countspot = countspot + 1;
                        $.each(data.data[key][2], function (i, e) {
                            context2 += "<tr id=\"scenic\">\n" +
                                "                            <td><label class=\"layui-form-label\">景点</label></td>\n" +
                                "                            <td>\n" +
                                "                                <select style=\"height:36px ; width: 170px\" name=\"city\" weight='" + countspot + "' lay-ignore spot=\"jingdian\" onchange=\"baojia(this)\">\n" +
                                "\n" +
                                "                                </select>\n" +
                                "                            </td>\n" +
                                "                            <td><label class=\"layui-form-label\">成本价:</label></td>\n" +
                                "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                                "                            <td><label class=\"layui-form-label\">报价:</label></td>\n" +
                                "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                                "<td style='bottom: 0px;'><label class='layui-form-label' onclick='san(this)'>×</label></td>" +
                                "                        </tr>";
                        })
                        context += "<div style='margin-bottom: 30px;width: 800px'>\n" +
                            "            <input type=\"image\" src=\"/images/up.PNG\" style=\"height: 30px;width: 35px;\" id=\"toggle\"\n" +
                            "                   onclick='qiehuan(this)'/>\n" +
                            "            <input type=\"image\" id=\"sc\" src=\"/images/del.PNG\" onclick='shanchu(this)'\n" +
                            "                   style=\"display:inline-block;float: right;height: 30px;width: 35px;\"/>\n" +
                            "            <div id=\"content\">\n" +
                            "                <form class=\"layui-form layui-form-pane\" action=\"\">\n" +
                            "                    <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n" +
                            "                        <tr>\n" +
                            "                            <td><label class=\"layui-form-label\" onchange='chengZi(this)'>线路</label></td>\n" +
                            "                            <td>\n" +
                            "                                <select style=\"height:36px ; width: 170px\" name=\"city\" lay-ignore lay-search xl=\"xianlu\" onchange='chengZi(this)'>\n" +
                            "\n" +
                            "                                </select>\n" +
                            "                            </td>\n" +
                            "                            <td colspan=\"2\">&nbsp;<button type=\"button\"\n" +
                            "                                                          class='layui-btn layui-btn-normal layui-btn-radius'\n" +
                            "                                                          style='height: 30px;width: 100px;' onclick=\"xianlu(this)\">自行填写\n" +
                            "                            </button>\n" +
                            "                            </td>\n" +
                            "                        </tr>\n" +
                            "                        <tr>\n" +
                            "                            <td><label class=\"layui-form-label\">日期</label></td>\n" +
                            "                            <td>\n" +
                            "                                <input type=\"text\" name=\"date\" id=\"date2\" lay-verify=\"date\" placeholder=\"yyyy-MM-dd\"\n" +
                            "                                       autocomplete=\"off\" class=\"layui-input\" value=''>\n" +
                            "                            </td>\n" +
                            "                        </tr>\n" +
                            "\n" +
                            "                        <tr>\n" +
                            "                            <td><label class=\"layui-form-label\">酒店</label></td>\n" +
                            "                            <td>\n" +
                            "                                <select style=\"height:36px ; width: 170px\" name=\"city\" lay-ignore hotel=\"jiudian\" onchange='baojia(this)'>\n" +
                            "\n" +
                            "                                </select>\n" +
                            "                            </td>\n" +
                            "                            <td><label class=\"layui-form-label\">成本价</label></td>\n" +
                            "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                            "                            <td><label class=\"layui-form-label\">报价</label></td>\n" +
                            "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                            "                        </tr>\n" +
                            "                        <!--点击新增景点-->\n" +
                            "                        <tr id=\"onClickjd\">\n" +
                            "                            <td colspan=\"2\">\n" +
                            "                                <button class=\"layui-btn\" type=\"button\" style=\"font-size: 12px\"\n" +
                            "                                        onclick=\"insertJingdian(this)\">添加景点+\n" +
                            "                                </button>\n" +
                            "                            </td>\n" +
                            "                        </tr>\n" +
                            context2 +
                            "                        <tr>\n" +
                            "                            <td><label class=\"layui-form-label\">午餐</label></td>\n" +
                            "                            <td>\n" +
                            "                                <select style=\"height:36px ; width: 170px\" name=\"city\" lay-ignore wc=\"wucan\" onchange='baojia(this)'>\n" +
                            "\n" +
                            "\n" +
                            "                                </select>\n" +
                            "                            </td>\n" +
                            "                            <td><label class=\"layui-form-label\">成本价</label></td>\n" +
                            "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                            "                            <td><label class=\"layui-form-label\">报价</label></td>\n" +
                            "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                            "                        </tr>\n" +
                            "                        <tr>\n" +
                            "                            <td><label class=\"layui-form-label\">晚餐</label></td>\n" +
                            "                            <td>\n" +
                            "                                <select style=\"height:36px ; width: 170px\" name=\"city\" lay-ignore wac=\"wancan\" onchange='baojia(this)'>\n" +
                            "\n" +
                            "                                </select>\n" +
                            "                            </td>\n" +
                            "                            <td><label class=\"layui-form-label\">成本价</label></td>\n" +
                            "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                            "                            <td><label class=\"layui-form-label\">报价</label></td>\n" +
                            "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                            "                        </tr>\n" +
                            "                        <tr>\n" +
                            "                            <td><label class=\"layui-form-label\">行程</label></td>\n" +
                            "                            <td colspan=\"5\"><textarea placeholder=\"请输入内容\" class=\"layui-textarea\" name=\"desc\">" + data.data[key][0].travelContent + "</textarea>\n" +
                            "                            </td>\n" +
                            "                        </tr>\n" +
                            "                    </table>\n" +
                            "                </form>\n" +
                            "            </div>\n" +
                            "        </div>";
                        var json2 = [];
                        $.each(data.data[key][2],function (o, e) {
                            var json3 = {"soptid": e.scenicSpotId,"offer":e.offer,"costPrice":e.costPrice};
                            json2.push(json3);
                        })
                        var hotelId = data.data[key].length > 0 ? data.data[key][1].hotelId : -1;
                        var hoffer = data.data[key].length > 0 ? data.data[key][1].offer : "";
                        var hcostPrice = data.data[key].length > 0 ? data.data[key][1].costPrice : "";
                        var wu
                        var wuoffer
                        var wucostPrice
                        var wan
                        var wanoffer
                        var wancostPrice
                        if (data.data[key][3] == null) {
                            wu = -1
                        } else {
                            wu = data.data[key][3].dictionariesId;
                            wuoffer= data.data[key][3].offer;
                            wucostPrice=data.data[key][3].costPrice
                        }
                        if (data.data[key][4] == null) {
                            wan = -1
                        } else {
                            wan = data.data[key][4].dictionariesId;
                            wanoffer=data.data[key][4].offer;
                            wancostPrice=data.data[key][4].costPrice;
                        }
                        var json = {
                            "day": key,
                            "xianlu": data.data[key][0].lineArriveName,
                            "xianludate":data.data[key][0].date,
                            "hotel": hotelId,
                            "hoffer":hoffer,
                            "hcostPrice":hcostPrice,
                            "sopt": json2,
                            "wu": wu,
                            "wuoffer":wuoffer,
                            "wucostPrice":wucostPrice,
                            "wan": wan,
                            "wanoffer":wanoffer,
                            "wancostPrice":wancostPrice,
                        };
                        selectJson3.push(json);
                        day = key;
                    }
                }
                //报价信息
                $("#beginDate").val(data.data["-1"][0].travelStartTime);//开团日期
                $("#endDate").val(data.data["-1"][0].travelEndTime);//结束日期
                $("#number").val(data.data["-1"][0].number);//人数
                $("[name='shopping']").val(data.data["-1"][0].shopping);//购物
                $("[name='notExclude']").val(data.data["-1"][0].notExclude);//不含
                $("[name='remarks']").val(data.data["-1"][0].remarks);//备注
                $("[name='reception']").val(data.data["-1"][0].reception);//接待标准
                $("[name='supervision']").val(data.data["-1"][0].supervision);//团体监督
                $("#tourist").val(data.data["-1"][0].tourist);//客源地
                //报价用车


                $("#carcostPrice").val(data.data["-2"][0].costPrice);//成本价
                $("#caroffer").val(data.data["-2"][0].offer)//报价
                //报价其它
                $("#othercostPrice").val(data.data["-3"][0].costPrice)
                $("#otheroffer").val(data.data["-3"][0].offer)
                $("#otherremarks").val(data.data["-3"][0].remarks)

                $("#zong").html(context);
                showInfo();
                $("#yongche").html(chedui);
                $("#zutuanshe").html(zutuanshe);
                $("#zongxianlu").html(zongxinalu)

                $("#zutuanshe").children("option[value=" + data.data["-1"][0].travelId + "]").attr("selected", "selected");//组团社
                $("#yongche").children("option[value=" + data.data["-2"][0].valueId + "]").attr("selected", "selected");//类型编号
                selectOption3(day);
            }, error: function () {
                alert("服务器异常")
            }
        })
    }

    //选中下拉框赋值报价成本价
    function baojia3(zhege,costPrice,offer) {
        $(zhege).parent().next().next().children().val(costPrice);
        $(zhege).parent().next().next().next().next().children().val(offer);
    }

    //选中下拉列表（总线路）
    function selectOption3(day) {
        $("[xl='xianlu']").each(function (i, e) {
            var xlid = selectJson3[i].xianlu;
            var xdate=selectJson3[i].xianludate;
            var xianluinfo = "<option selected='selected' value='-2'>" + xlid + "</option>";
            e.options[e.options.length] = new Option(xlid, -2);
            $(e).children().eq(e.options.length - 1).attr("selected", "selected");
            $(e).parent().parent().next().find("[name='date']").val(xdate);
        })
        $("[hotel='jiudian']").each(function (i, e) {
            var id = selectJson3[i].hotel;
            var bj=selectJson3[i].hoffer;
            var cb=selectJson3[i].hcostPrice;
            $(e).children("option[value=" + id + "]").attr("selected", "selected");
            baojia3($(this),cb,bj);
        })
        $("[wc='wucan']").each(function (i, e) {
            var id = selectJson3[i].wu;
            var bj=selectJson3[i].wuoffer;
            var cb=selectJson3[i].wucostPrice;
            $(e).children("option[value=" + id + "]").attr("selected", "selected");
            baojia3($(this),cb,bj);
        })
        $("[wac='wancan']").each(function (i, e) {
            var id = selectJson3[i].wan;
            var bj=selectJson3[i].wanoffer;
            var cb=selectJson3[i].wancostPrice;
            $(e).children("option[value=" + id + "]").attr("selected", "selected");
            baojia3($(this),cb,bj);
        })
        var jdJson = [];
        var jdofferJson=[];
        var jdcosPriceJson=[];
        for (var i = 0; i < parseInt(day); i++) {
            $.each(selectJson3[i].sopt, function (j, p) {
                //alert(selectJson3[i].sopt[j].soptid);
                var json = {id: selectJson3[i].sopt[j].soptid};
                var json1={offer:selectJson3[i].sopt[j].offer};
                var json2={costPrice:selectJson3[i].sopt[j].costPrice};
                jdJson.push(json);
                jdofferJson.push(json1);
                jdcosPriceJson.push(json2);
            })
        }
        $("[spot='jingdian']").each(function (i, e) {
            var id;
            var temp = $(this);
            id = jdJson[i].id;
            var bj=jdofferJson[i].offer;
            var cb=jdcosPriceJson[i].costPrice
            temp.children("option[value=" + id + "]").attr("selected", "selected");
            baojia3($(this),cb,bj);
        })
    }


    function chengZhong(zhege) {
        $.ajax({
            url: "/offer/listAllByLineId?lineId=" + $(zhege).val() + "",
            data: "",
            dataType: "json",
            async: false,
            type: "get",
            success: function (data) {
                var context = "";
                var jiudian = "";
                var jingdian = "";
                selectJson = [];
                var countspot = 0;//景点权重
                for (var key in data.data) {
                    var context2 = "";
                    countspot++;
                    $.each(data.data[key].templateScenicspotList, function (i, e) {
                        context2 += "<tr id=\"scenic\">\n" +
                            "                            <td><label class=\"layui-form-label\">景点</label></td>\n" +
                            "                            <td>\n" +
                            "                                <select style=\"height:36px ; width: 170px\" name=\"city\" weight='" + countspot + "' lay-ignore spot=\"jingdian\"onchange=\"baojia(this)\">\n" +
                            "\n" +
                            "                                </select>\n" +
                            "                            </td>\n" +
                            "                            <td><label class=\"layui-form-label\">成本价:</label></td>\n" +
                            "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                            "                            <td><label class=\"layui-form-label\">报价:</label></td>\n" +
                            "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                            "<td style='bottom: 0px;'><label class='layui-form-label' onclick='san(this)'>×</label></td>" +
                            "                        </tr>";
                    })
                    context += "<div style='margin-bottom: 30px;width: 800px'>\n" +
                        "            <input type=\"image\" src=\"/images/up.PNG\" style=\"height: 30px;width: 35px;\" id=\"toggle\"\n" +
                        "                   onclick='qiehuan(this)'/>\n" +
                        "            <input type=\"image\" id=\"sc\" src=\"/images/del.PNG\" onclick='shanchu(this)'\n" +
                        "                   style=\"display:inline-block;float: right;height: 30px;width: 35px;\"/>\n" +
                        "            <div id=\"content\">\n" +
                        "                <form class=\"layui-form layui-form-pane\" action=\"\">\n" +
                        "                    <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n" +
                        "                        <tr>\n" +
                        "                            <td><label class=\"layui-form-label\" onchange='chengZi(this)'>线路</label></td>\n" +
                        "                            <td>\n" +
                        "                                <select style=\"height:36px ; width: 170px\" name=\"city\" lay-ignore lay-search xl=\"xianlu\" onchange='chengZi(this)'>\n" +
                        "\n" +
                        "                                </select>\n" +
                        "                            </td>\n" +
                        "                            <td colspan=\"2\">&nbsp;<button type=\"button\"\n" +
                        "                                                          class='layui-btn layui-btn-normal layui-btn-radius'\n" +
                        "                                                          style='height: 30px;width: 100px;' onclick=\"xianlu(this)\">自行填写\n" +
                        "                            </button>\n" +
                        "                            </td>\n" +
                        "                            <td colspan=\"2\">&nbsp;<button type=\"button\"\n" +
                        "                                                          class='layui-btn layui-btn-normal layui-btn-radius'\n" +
                        "                                                          style='height: 30px;width: 100px'>保存模板\n" +
                        "                            </button>\n" +
                        "                            </td>\n" +
                        "                        </tr>\n" +
                        "                        <tr>\n" +
                        "                            <td><label class=\"layui-form-label\">日期</label></td>\n" +
                        "                            <td>\n" +
                        "                                <input type=\"text\" name=\"date\" id=\"date2\" lay-verify=\"date\" placeholder=\"yyyy-MM-dd\"\n" +
                        "                                       autocomplete=\"off\" class=\"layui-input\" value=''>\n" +
                        "                            </td>\n" +
                        "                        </tr>\n" +
                        "\n" +
                        "                        <tr>\n" +
                        "                            <td><label class=\"layui-form-label\">酒店</label></td>\n" +
                        "                            <td>\n" +
                        "                                <select style=\"height:36px ; width: 170px\" name=\"city\" lay-ignore hotel=\"jiudian\" onchange='baojia(this)'>\n" +
                        "\n" +
                        "                                </select>\n" +
                        "                            </td>\n" +
                        "                            <td><label class=\"layui-form-label\">成本价</label></td>\n" +
                        "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                        "                            <td><label class=\"layui-form-label\">报价</label></td>\n" +
                        "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                        "                        </tr>\n" +
                        "                        <!--点击新增景点-->\n" +
                        "                        <tr id=\"onClickjd\">\n" +
                        "                            <td colspan=\"2\">\n" +
                        "                                <button class=\"layui-btn\" type=\"button\" style=\"font-size: 12px\"\n" +
                        "                                        onclick=\"insertJingdian(this)\">添加景点+\n" +
                        "                                </button>\n" +
                        "                            </td>\n" +
                        "                        </tr>\n" +
                        context2 +
                        "                        <tr>\n" +
                        "                            <td><label class=\"layui-form-label\">午餐</label></td>\n" +
                        "                            <td>\n" +
                        "                                <select style=\"height:36px ; width: 170px\" name=\"city\" lay-ignore wc=\"wucan\" onchange='baojia(this)'>\n" +
                        "\n" +
                        "\n" +
                        "                                </select>\n" +
                        "                            </td>\n" +
                        "                            <td><label class=\"layui-form-label\">成本价</label></td>\n" +
                        "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                        "                            <td><label class=\"layui-form-label\">报价</label></td>\n" +
                        "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                        "                        </tr>\n" +
                        "                        <tr>\n" +
                        "                            <td><label class=\"layui-form-label\">晚餐</label></td>\n" +
                        "                            <td>\n" +
                        "                                <select style=\"height:36px ; width: 170px\" name=\"city\" lay-ignore wac=\"wancan\" onchange='baojia(this)'>\n" +
                        "\n" +
                        "                                </select>\n" +
                        "                            </td>\n" +
                        "                            <td><label class=\"layui-form-label\">成本价</label></td>\n" +
                        "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                        "                            <td><label class=\"layui-form-label\">报价</label></td>\n" +
                        "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                        "                        </tr>\n" +
                        "                        <tr>\n" +
                        "                            <td><label class=\"layui-form-label\">行程</label></td>\n" +
                        "                            <td colspan=\"5\"><textarea placeholder=\"请输入内容\" class=\"layui-textarea\" name=\"desc\">" + data.data[key].templateContent + "</textarea>\n" +
                        "                            </td>\n" +
                        "                        </tr>\n" +
                        "                    </table>\n" +
                        "                </form>\n" +
                        "            </div>\n" +
                        "        </div>";
                    var json2 = [];
                    $.each(data.data[key].templateScenicspotList, function (i, e) {
                        var json3 = {"soptid": e.scenicSpotId};
                        json2.push(json3);
                    })
                    var json = {
                        "day": key,
                        "xianlu": data.data[key].templateId,
                        "hotel": data.data[key].templateHotel.hotelId,
                        "sopt": json2
                    };
                    selectJson.push(json);
                    //alert(data.data[key].templateHotel.hotelId)
                }
                $("#zong").html(context);
                showInfo();
                selectOption();
                totalchange();
            }, error: function () {
                alert("服务器异常！")
            }
        })
    }


    //选中下拉列表（当天线路）
    function selectOption2(zhege) {
        $($(zhege).parent().parent().parent().find("[xl='xianlu']")).each(function (i, e) {
            var xlid = selectJson2[i].xianlu;
            $(this).children("option[value=" + xlid + "]").attr("selected", "selected");
            baojia($(this));
        })
        $($(zhege).parent().parent().parent().find("[hotel='jiudian']")).each(function (i, e) {
            var id = selectJson2[i].hotel;
            $(this).children("option[value=" + id + "]").attr("selected", "selected");
            baojia($(this));
        })
        var jdJson = [];
        $.each(selectJson2[0].sopt, function (j, p) {
            var json = {id: selectJson2[0].sopt[j].soptid};
            jdJson.push(json);
        })
        $($(zhege).parent().parent().parent().find("[spot='jingdian']")).each(function (i, e) {
            var id = jdJson[i].id;
            $(this).children("option[value=" + id + "]").attr("selected", "selected");
            baojia($(this));
        })
    }

    //选中下拉列表（总线路）
    function selectOption() {
        $("[xl='xianlu']").each(function (i, e) {
            var xlid = selectJson[i].xianlu;
            $(this).children("option[value=" + xlid + "]").attr("selected", "selected");
            baojia($(this));
        })
        $("[hotel='jiudian']").each(function (i, e) {
            var id = selectJson[i].hotel;
            $(this).children("option[value=" + id + "]").attr("selected", "selected");
            baojia($(this));
        })
        var jdJson = [];

        $("[spot='jingdian']").each(function (i, e) {
            var id;
            var temp = $(this);
            $.each(selectJson[i].sopt, function (j, p) {
                var json = {id: selectJson[i].sopt[j].soptid};
                jdJson.push(json);
            })
            id = jdJson[i].id;
            temp.children("option[value=" + id + "]").attr("selected", "selected");
            baojia($(this));
        })
    }

    //选中线路为当天模板赋值
    function chengZi(zhege) {
        var count = $(zhege).parent().parent().parent().find("[spot='jingdian']").attr("weight");
        var id = $(zhege).val();
        $.ajax({
            url: "/offer/listAllByTemplateId?templateId=" + id + "",
            data: "",
            dataType: "json",
            type: "get",
            async: false,
            success: function (data) {
                var tempYs = $(zhege).parent().parent().parent();
                var tempYs2 = $(zhege).parent().parent().next().next().next();
                selectJson2 = [];
                //获取最外层td
                var trs = $(zhege).parent().parent();
                //日期赋值
                //trs.next().find("input").val(data.data.creationDate);
                var json2 = [];
                var context = "";
                tempYs.find("[id='scenic']").remove();
                $.each(data.data.templateScenicspotList, function (i, e) {
                    context += "<tr id=\"scenic\">\n" +
                        "                            <td><label class=\"layui-form-label\">景点</label></td>\n" +
                        "                            <td>\n" +
                        "                                <select style=\"height:36px ; width: 170px\" name=\"city\" weight='" + count + "' lay-ignore spot=\"jingdian\"onchange=\"baojia(this)\">\n" +
                        "\n" +
                        "                                </select>\n" +
                        "                            </td>\n" +
                        "                            <td><label class=\"layui-form-label\">成本价:</label></td>\n" +
                        "                            <td><input type=\"text\" name='costPrice' class=\"layui-input\"></td>\n" +
                        "                            <td><label class=\"layui-form-label\">报价:</label></td>\n" +
                        "                            <td><input type=\"text\" name='offer' class=\"layui-input\"></td>\n" +
                        "<td style='bottom: 0px;'><label class='layui-form-label' onclick='san(this)'>×</label></td>" +
                        "                        </tr>";
                    var json3 = {"soptid": e.scenicSpotId};
                    json2.push(json3);
                })
                tempYs2.after(context);
                var json = {"hotel": data.data.templateHotel.hotelId, "sopt": json2};
                selectJson2.push(json);
                showInfo2(zhege);
                selectOption2(zhege);
                totalchange();
            }, error: function () {
                alert("程序异常！")
            }
        })

    }

    //选中下拉框赋值报价成本价
    function baojia(zhege) {
        var one = $(zhege).parent;
        var bj = $(zhege).find("option:selected").attr("offer");
        var cb = $(zhege).find("option:selected").attr("costPrice");
        $(zhege).parent().next().next().children().val(cb);
        $(zhege).parent().next().next().next().next().children().val(bj);
        total();
    }

    function showInfo2(zhege) {
        jingdian = "<option value='-1'>请选择</option>";
        jiudian = "<option value='-1'>请选择</option>";
        wancan = "<option value='-1'>请选择</option>";
        wucan = "<option value='-1'>请选择</option>";
        xianluinfo = "<option value='-1'>请选择</option>";
        $.ajax({
            url: "/offer/listAllShow",
            data: "",
            dataType: "json",
            type: "get",
            async: false,
            success: function (data) {
                //查询所有线路名
                $.each(data.data[0], function (i, e) {
                    zongxinalu += "<option  value='" + e.lineid + "'>" + e.linename + "</option>";
                })

                //查询所有当日行程
                $.each(data.data[1], function (i, e) {
                    xianluinfo += "<option value='" + e.templateId + "'>" + e.templateName + "</option>";
                })

                //查询所有景点
                $.each(data.data[2], function (i, e) {
                    jingdian += "<option value='" + e.scenicSpotId + "' costPrice='" + e.costprice + "' offer='" + e.offer + "'>" + e.scenicSpotName + "</option>";
                })

                //查询所有酒店
                $.each(data.data[3], function (i, e) {
                    jiudian += "<option value='" + e.hotelId + "' costPrice='" + e.costprice + "' offer='" + e.offer + "'>" + e.hotelName + "</option>";
                })

                //查询所有饭菜类型
                $.each(data.data[4], function (i, e) {
                    wancan += "<option value='" + e.valueId + "' costPrice='" + e.valueContent2 + "' offer='" + e.valueContent3 + "'>" + e.valueContent1 + "</option>";
                    wucan += "<option value='" + e.valueId + "' costPrice='" + e.valueContent2 + "' offer='" + e.valueContent3 + "'>" + e.valueContent1 + "</option>";
                })
                $.each(data.data[5], function (i, e) {
                    chedui += "<option value='" + e.valueId + "' costPrice='" + e.valueContent2 + "' offer='" + e.valueContent3 + "'>" + e.valueContent1 + "</option>";
                })
                $.each(data.data[6], function (i, e) {
                    zutuanshe += "<option value='" + e.travelId + "'>" + e.travelName + "</option>";
                })
                $($(zhege).parent().parent().parent().find("[spot='jingdian']")).html(jingdian);
                $($(zhege).parent().parent().parent().find("[hotel='jiudian']")).html(jiudian)
                $($(zhege).parent().parent().parent().find("[wac='wancan']")).html(wancan);
                $($(zhege).parent().parent().parent().find("[wc='wucan']")).html(wucan);
            }, error: function () {
                alert(123);
            }
        })
    }

    function showInfo() {
        zongxinalu = "<option value='-1'>请选择</option>";
        jingdian = "<option value='-1'>请选择</option>";
        jiudian = "<option value='-1'>请选择</option>";
        wancan = "<option value='-1'>请选择</option>";
        wucan = "<option value='-1'>请选择</option>";
        xianluinfo = "<option value='-1'>请选择</option>";
        $.ajax({
            url: "/offer/listAllShow",
            data: "",
            dataType: "json",
            type: "get",
            async: false,
            success: function (data) {
                //查询所有线路名
                $.each(data.data[0], function (i, e) {
                    zongxinalu += "<option  value='" + e.lineid + "'>" + e.linename + "</option>";
                })

                //查询所有当日行程
                $.each(data.data[1], function (i, e) {
                    xianluinfo += "<option value='" + e.templateId + "'>" + e.templateName + "</option>";
                })

                //查询所有景点
                $.each(data.data[2], function (i, e) {
                    jingdian += "<option value='" + e.scenicSpotId + "' costPrice='" + e.costprice + "' offer='" + e.offer + "'>" + e.scenicSpotName + "</option>";
                })

                //查询所有酒店
                $.each(data.data[3], function (i, e) {
                    jiudian += "<option value='" + e.hotelId + "' costPrice='" + e.costprice + "' offer='" + e.offer + "'>" + e.hotelName + "</option>";
                })

                //查询所有饭菜类型
                $.each(data.data[4], function (i, e) {
                    wancan += "<option value='" + e.valueId + "' costPrice='" + e.valueContent2 + "' offer='" + e.valueContent3 + "'>" + e.valueContent1 + "</option>";
                    wucan += "<option value='" + e.valueId + "' costPrice='" + e.valueContent2 + "' offer='" + e.valueContent3 + "'>" + e.valueContent1 + "</option>";
                })
                $.each(data.data[5], function (i, e) {
                    chedui += "<option value='" + e.valueId + "' costPrice='" + e.valueContent2 + "' offer='" + e.valueContent3 + "'>" + e.valueContent1 + "</option>";
                })
                $.each(data.data[6], function (i, e) {
                    zutuanshe += "<option value='" + e.travelId + "'>" + e.travelName + "</option>";
                })
                $("[xl='xianlu']").html(xianluinfo);
                $("[spot='jingdian']").html(jingdian);
                $("[hotel='jiudian']").html(jiudian)
                $("[wac='wancan']").html(wancan);
                $("[wc='wucan']").html(wucan);
            }, error: function () {
                alert(123);
            }
        })
    }


    //报价表信息
    function offerTable() {
        offerJson = {};
        var travelStartTime = $("#beginDate").val();//开团日期
        var travelEndTime = $("#endDate").val();//结束日期
        var number = $("#number").val();//人数
        var travelId = $("#zutuanshe").val();//组团社
        var offer = $("#offerTotal").val();//报价
        var trip = "";//行程
        var shopping = $("[name='shopping']").val();//购物
        var notExclude = $("[name='notExclude']").val();//不含
        var remarks = $("[name='remarks']").val();//备注
        var reception = $("[name='reception']").val();//接待标准
        var supervision = $("[name='supervision']").val();//团体监督
        var tourist = $("#tourist").val();//客源地
        $("[name='desc']").each(function (i, e) {
            trip += $(this).val();
            trip += "--";
        })
        //报价信息字符串
        offerJson = {
            "travelId": travelId,
            "travelStartTime": travelStartTime,
            "travelEndTime": travelEndTime,
            "number": number,
            "tourist": tourist,
            "trip": trip,
            "offer": offer,
            "shopping": shopping,
            "notExclude": notExclude,
            "remarks": remarks,
            "supervision": supervision,
            "reception": reception
        };
    }

    //报价用车表
    function carTbale() {
        carJson = {};
        var valueId = $("#yongche").val();//类型编号
        var number = 1//$("#carnumber").val()数量
        var costPrice = $("#carcostPrice").val();//成本价
        var offer = $("#caroffer").val()//报价
        carJson = {
            "valueId": valueId,
            "costPrice": costPrice,
            "offer": offer,
            "number": number
        }
    }

    //报价酒店
    function hotelTable() {
        hotelJson = [];
        $("[hotel='jiudian']").each(function (i, e) {
            var costPrice=$(e).parent().next().next().children().val();
            var offer=$(e).parent().next().next().next().next().children().val();
            var json = {};
            var hotelId = $(this).val();
            var weight = i + 1;
            json = {
                "hotelId": hotelId,
                "costPrice": costPrice,
                "offer": offer,
                "weight": weight
            }
            hotelJson.push(json);
        })
    }

    //报价景点
    function spotTable() {
        spotJson = [];
        $("[spot='jingdian']").each(function (i, e) {
            var cosPrice=$(e).parent().next().next().children().val();
            var offer=$(e).parent().next().next().next().next().children().val();
            var json = {
                "scenicSpotId": $(this).val(),
                "costPrice": cosPrice,
                "offer":offer,
                "weight":$(this).attr("weight")
            }
            spotJson.push(json);
        })
    }

    //报价餐馆
    function restaurantTable() {
        restaurantJson = [];
        var json = {};//午餐
        var json2 = {};//晚餐
        $("[wc='wucan']").each(function (i, e) {
            var cosPrice=$(e).parent().next().next().children().val();
            var offer=$(e).parent().next().next().next().next().children().val();
            json = {
                "dictionariesId": $(this).val(),
                "costPrice": cosPrice,
                "weight": (i + 1),
                "offer":offer,
                "havemealsdate": "2"
            }
            restaurantJson.push(json);
        })
        $("[wac='wancan']").each(function (i, e) {
            var cosPrice=$(e).parent().next().next().children().val();
            var offer=$(e).parent().next().next().next().next().children().val();
            json2 = {
                "dictionariesId": $(this).val(),
                "costPrice": cosPrice,
                "weight": (i + 1),
                "offer":offer,
                "havemealsdate": "3"
            }
            restaurantJson.push(json2);
        })

    }

    //报价其它
    function otherTable() {
        otherJson = {
            "costPrice": $("#othercostPrice").val(),
            "offer": $("#otheroffer").val(),
            "remarks": $("#otherremarks").val()
        };
    }

    //报价线路
    function lineTable() {
        lineJson = [];
        $("[xl='xianlu']").each(function (i, e) {
            var lineArriveName
            if($(this).attr("name")=="texts"){
                lineArriveName=$(this).val();
            }else{
                lineArriveName=$(this).find("option:selected").text()
            }
            var json = {
                "lineArriveName": lineArriveName,
                "date":$(this).parent().parent().parent().find("[id='date2']").val(),
                "travelContent": $(this).parent().parent().parent().find("[name='desc']").val(),
                "weight": (i+1)
            }
            lineJson.push(json);
        })
    }

    var offerJson = {};//报价
    var carJson = {};//报价用车
    var hotelJson = [];//报价酒店
    var spotJson = [];//报价景点
    var restaurantJson = [];//报价餐厅
    var otherJson = {};//报价其它
    var lineJson = [];//报价线路

    //新增报价信息
    function insertOffer() {
        offerTable();
        carTbale();
        hotelTable();
        spotTable();
        restaurantTable();
        otherTable();
        lineTable();
        var offerJsonPlus = {
            "offer": offerJson,
            "offercar": carJson,
            "listOfferHotel": hotelJson,
            "listOfferscenic": spotJson,
            "listOfferrestaurant": restaurantJson,
            "offerother": otherJson,
            "listOfferline": lineJson
        };
        $.ajax({
            url: "/offer/insertOffer",
            data: JSON.stringify(offerJsonPlus),
            dataType: "json",
            type: "post",
            async:false,
            contentType: "application/json",
            success: function (data) {
                alert("修改成功！")
            }, error: function () {
                alert("程序异常")
            }
        })
    }
    //删除报价信息
    function deleteOffer(){
        $.ajax({
            url: "/offer/deleteOffer",
            data: {id:$("#offerId").val()},
            dataType: "json",
            type: "post",
            async:false,
            success: function (data) {
            }, error: function () {
                alert("程序异常")
            }
        })
    }
    //报价按钮单击事件
    $("#baocun").click(function () {
        deleteOffer();
        insertOffer();
        $.ajax({
            url:"/offer/updateOfferValue1Two",
            data:{value1:1},
            dataType:"json",
            type:"get",
            async:false,
            success:function(data){
            },error:function () {
                alert("服务器异常")
            }
        })
        flag=true;
    })


</script>
<script type="text/javascript">
    function san(dang) {
        $(dang).parent().parent().remove();
        totalchange();
    }

    function add(onClickjd) {
        $(onClickjd).parent().parent().next().after("<tr id='scenic'>" +
            "<td><label class='layui-form-label'>景点</label></td>" +
            "<td>" +
            "<select style=\"height:36px ; width: 170px\" name='city' lay-verify='required'>" +
            "<option value=''></option>" +
            jingdian +
            "</select>" +
            "</td>" +
            "<td><label class='layui-form-label'>成本价:</label></td>" +
            "<td><input type='text' name='costPrice' class='layui-input'></td>" +
            "<td><label class='layui-form-label'>报价:</label></td>" +
            "<td><input type='text' name='offer' class='layui-input'></td>" +
            "<td style='bottom: 0px;'><label class='layui-form-label' onclick='san(this)'>×</label></td>" +
            "</tr>");
        layui.use(['form', 'layedit', 'laydate', 'element'], function () {
            var form = layui.form,
                layer = layui.layer,
                layedit = layui.layedit,
                element = layui.element,
                laydate = layui.laydate,
                a;
            form.render(); //更新全部
            form.render('select'); //刷新select选择框渲染
        });
    }

    $(function () {
        layui.use(['form', 'layedit', 'laydate', 'element'], function () {
            var form = layui.form,
                layer = layui.layer,
                layedit = layui.layedit,
                element = layui.element,
                laydate = layui.laydate;
            //日期
            laydate.render({
                elem: '#beginDate'
            });
            laydate.render({
                elem: '#endDate'
            });
            laydate.render({
                elem: '#date2'
            });
            element.render('test1');
            form.render('select', 'test1');
            form.on('radio(*)', function (data) {
                /*console.log(data.elem); //得到radio原始DOM对象
                 console.log(data.value); //被点击的radio的value值*/
                alert("是是是");

            });
        });
    });
    totalchange();
    //计算总价
    function totalchange(){
        $("[name='offer']").each(function (i, e) {
            $(e).attr("onchange","total()");
        })
        $("[name='costPrice']").each(function (i, e) {
            $(e).attr("onchange","total()");
        })
        total();
    }
    //计算总价
    function total() {
        var offer=0;
        var costPrice=0;
        var bbbb=parseInt($("[xl='xianlu']").length);
        $("[name='offer']").each(function (i, e) {
            if($(this).val()!=""){
                offer += parseInt($(this).val());
            }
        })
        $("[name='costPrice']").each(function (i, e) {
            if($(this).val()!=""){
                costPrice += parseInt($(this).val());
            }
        })
        if($("#number").val()!="") {
            offer = offer * parseInt($("#number").val());
            costPrice = costPrice * parseInt($("#number").val());
        }
        var cccc=parseInt($("#caroffer").val())*bbbb;
        var dddd=parseInt($("#carcostPrice").val())*bbbb;
        var hhhh=parseInt($("#otheroffer").val());
        var jjjj=parseInt($("#othercostPrice").val());
        if(!isNaN(cccc)){
            offer+=cccc;
        }
        if(!isNaN(hhhh)){
            offer+=hhhh;
        }
        cccc=(parseInt($("#carcostPrice").val())+parseInt($("#othercostPrice").val()))*bbbb;
        if(!isNaN(dddd)) {
            costPrice += dddd;
        }
        if(!isNaN(jjjj)){
            costPrice+=jjjj
        }
        $("#costPriceTotal").val(costPrice);
        $("#offerTotal").val(offer);
    }
    //设置页面元素为只读
    if($("#redonly").val()==1){
        $("input").each(function (i,e) {
            $(e).attr("disabled","disabled");
        })
        $("select").each(function (i,e) {
            $(e).attr("disabled","disabled");
        })
        $("textarea").each(function (i,e) {
            $(e).attr("disabled","disabled");
        })
        $("button").each(function (i,e) {
            $(e).attr("disabled","disabled");
        })
    }

    var flag=false;
    $("#printBaojia").click(function () {
        if(flag){
            $.ajax({
                url: "/offer/getLastOfferId",
                data: "",
                dataType: "json",
                type: "get",
                success: function (result) {
                    window.open("http://localhost:8888/voucher/baojiandan.html?offerId="+result.data+"");
                },
                error: function (res) {
                    alert(res);
                }
            })
        }else{
            window.open("http://localhost:8888/voucher/baojiandan.html?offerId="+$("#offerId").val()+"");
        }
    })
    //报价预览按钮单击事件
    $("#yulan").click(function () {
        if(flag){
            offerTable();
            var xingcheng = [];
            $("[xl='xianlu']").each(function (i, e) {
                var lineArriveName
                var parent = $(this).parent().parent().parent();
                if ($(this).attr("name") == "texts") {
                    lineArriveName = $(this).val();
                } else {
                    lineArriveName = $(this).find("option:selected").text()
                }
                var day = parent.find("[name='date']").val();//天数
                day = day.substring(day.indexOf("-") + 1);
                var dl = lineArriveName;//线路
                var xc = parent.find("[name='desc']").val();//行程
                var cs = "";//餐食
                if (i != 0) {
                    cs += "B酒店自助 ";
                }
                var wu = parent.find("[wc='wucan']").find("option:selected").text();//午餐
                var wub = parent.find("[wc='wucan']").find("option:selected").attr("offer");//午餐报价
                if (parent.find("[wc='wucan']").val() != "-1") {
                    cs += "<br/>L" + wu + " " + wub + " ";
                }
                var wac = parent.find("[wac='wancan']").find("option:selected").text();//晚餐
                var wacb = parent.find("[wac='wancan']").find("option:selected").attr("offer");//晚餐报价
                if (parent.find("[wac='wancan']").val() != "-1") {
                    cs += "<br/>D" + wac + " " + wacb;
                }
                var zs = parent.find("[hotel='jiudian']").find("option:selected").text();//住宿
                var zsdh = parent.find("[hotel='jiudian']").val();//住宿电话
                var json = {
                    "day": day,
                    "dl": dl,
                    "xc": xc,
                    "cs": cs,
                    "zs": zs,
                    "zsdh": zsdh
                }
                xingcheng.push(json);
            })
            var previewJson = {"offer": offerJson, "list": xingcheng};//预览报价json
            $.ajax({
                url: "/offer/previewOffer",
                data: JSON.stringify(previewJson),
                dataType: "json",
                type: "post",
                contentType: "application/json",
                async: false,
                success: function (data) {
                }, error: function () {
                    alert("程序异常")
                }
            })
            window.open("http://localhost:8888/voucher/Confirmation.html");
        }else{

        }
    })
</script>
</body>

</html>